{"version":3,"file":"wx.js","sources":["utils/wx.js"],"sourcesContent":["/**\r\n * 微信小程序API封装\r\n * 将微信原生API Promise化，便于使用\r\n */\r\n\r\n/**\r\n * 获取微信登录凭证\r\n * @returns {Promise<string>} 登录凭证(code)\r\n */\r\nconst login = () => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.login({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        if (res.code) {\r\n          resolve(res.code);\r\n        } else {\r\n          reject(new Error(res.errMsg || '获取code失败'));\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '登录失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 获取用户信息（基于button授权的方式）\r\n * @param {Object} options - 配置项\r\n * @returns {Promise<Object>} 用户信息\r\n */\r\nconst getUserProfile = (options = {}) => {\r\n  return new Promise((resolve, reject) => {\r\n    // #ifdef MP-WEIXIN\r\n    wx.getUserProfile({\r\n      desc: options.desc || '用于完善用户资料',\r\n      lang: options.lang || 'zh_CN',\r\n      success: (res) => {\r\n        resolve(res.userInfo);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '获取用户信息失败'));\r\n      }\r\n    });\r\n    // #endif\r\n    \r\n    // #ifndef MP-WEIXIN\r\n    uni.getUserInfo({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        resolve(res.userInfo);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '获取用户信息失败'));\r\n      }\r\n    });\r\n    // #endif\r\n  });\r\n};\r\n\r\n/**\r\n * 检查用户是否已授权\r\n * @param {string} scope - 需要检查的权限\r\n * @returns {Promise<boolean>} 是否已授权\r\n */\r\nconst checkAuthorize = (scope) => {\r\n  return new Promise((resolve) => {\r\n    uni.getSetting({\r\n      success: (res) => {\r\n        if (res.authSetting[`scope.${scope}`]) {\r\n          resolve(true);\r\n        } else {\r\n          resolve(false);\r\n        }\r\n      },\r\n      fail: () => {\r\n        resolve(false);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 获取当前位置\r\n * @returns {Promise<Object>} 位置信息\r\n */\r\nconst getLocation = () => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.getLocation({\r\n      type: 'gcj02',\r\n      success: (res) => {\r\n        resolve({\r\n          latitude: res.latitude,\r\n          longitude: res.longitude,\r\n          speed: res.speed,\r\n          accuracy: res.accuracy,\r\n          altitude: res.altitude,\r\n          verticalAccuracy: res.verticalAccuracy,\r\n          horizontalAccuracy: res.horizontalAccuracy\r\n        });\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '获取位置失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 保存图片到相册\r\n * @param {string} filePath - 图片文件路径\r\n * @returns {Promise<boolean>} 是否保存成功\r\n */\r\nconst saveImageToPhotosAlbum = (filePath) => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.saveImageToPhotosAlbum({\r\n      filePath,\r\n      success: () => {\r\n        resolve(true);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '保存图片失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 在新页面中全屏预览图片\r\n * @param {Object} options - 配置项\r\n * @returns {Promise<void>}\r\n */\r\nconst previewImage = (options) => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.previewImage({\r\n      urls: options.urls,\r\n      current: options.current || options.urls[0],\r\n      success: () => {\r\n        resolve();\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '预览图片失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 微信支付\r\n * @param {Object} payParams - 支付参数\r\n * @returns {Promise<Object>} 支付结果\r\n */\r\nconst requestPayment = (payParams) => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.requestPayment({\r\n      provider: 'wxpay',\r\n      ...payParams,\r\n      success: (res) => {\r\n        resolve(res);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '支付失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport default {\r\n  login,\r\n  getUserProfile,\r\n  checkAuthorize,\r\n  getLocation,\r\n  saveImageToPhotosAlbum,\r\n  previewImage,\r\n  requestPayment\r\n}; "],"names":["uni","wx"],"mappings":"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"}