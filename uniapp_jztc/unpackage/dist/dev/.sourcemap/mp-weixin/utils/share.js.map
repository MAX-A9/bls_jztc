{"version":3,"file":"share.js","sources":["utils/share.js"],"sourcesContent":["/**\r\n * 分享工具类\r\n */\r\nimport { share as shareApi } from '../apis/index.js';\r\n\r\n// 分享设置缓存\r\nlet shareSettings = null;\r\n\r\n/**\r\n * 获取分享设置\r\n * @param {Boolean} forceRefresh 是否强制刷新\r\n * @returns {Promise} 返回分享设置Promise\r\n */\r\nexport async function getShareSettings(forceRefresh = false) {\r\n  // 如果有缓存且不强制刷新，则直接返回缓存\r\n  if (shareSettings && !forceRefresh) {\r\n    return shareSettings;\r\n  }\r\n  \r\n  try {\r\n    // 调用API获取分享设置\r\n    const result = await shareApi.getShareSettings();\r\n    if (result && result.code === 0 && result.data) {\r\n      // 更新缓存\r\n      shareSettings = result.data;\r\n      return shareSettings;\r\n    } else {\r\n      console.error('获取分享设置失败:', result);\r\n      return null;\r\n    }\r\n  } catch (error) {\r\n    console.error('获取分享设置出错:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * 获取内容分享参数\r\n * @param {Object} content 内容对象\r\n * @returns {Promise<Object>} 分享参数\r\n */\r\nexport async function getContentShareOptions(content) {\r\n  const settings = await getShareSettings();\r\n  if (!settings) {\r\n    return {\r\n      title: '分享内容',\r\n      path: '/pages/index/index'\r\n    };\r\n  }\r\n  \r\n  // 使用内容信息构建分享参数\r\n  return {\r\n    title: content?.title || settings.content_share_text,\r\n    imageUrl: content?.cover || settings.content_share_image,\r\n    path: content?.id ? `/pages/content/detail?id=${content.id}` : '/pages/index/index'\r\n  };\r\n}\r\n\r\n/**\r\n * 获取首页分享参数\r\n * @returns {Promise<Object>} 分享参数\r\n */\r\nexport async function getHomeShareOptions() {\r\n  const settings = await getShareSettings();\r\n  if (!settings) {\r\n    return {\r\n      title: '欢迎访问',\r\n      path: '/pages/index/index'\r\n    };\r\n  }\r\n  \r\n  return {\r\n    title: settings.home_share_text,\r\n    imageUrl: settings.home_share_image,\r\n    path: '/pages/index/index'\r\n  };\r\n}\r\n\r\n/**\r\n * 获取默认分享参数\r\n * @param {String} path 分享路径\r\n * @returns {Promise<Object>} 分享参数\r\n */\r\nexport async function getDefaultShareOptions(path = '/pages/index/index') {\r\n  const settings = await getShareSettings();\r\n  if (!settings) {\r\n    return {\r\n      title: '欢迎访问',\r\n      path: path\r\n    };\r\n  }\r\n  \r\n  return {\r\n    title: settings.default_share_text,\r\n    imageUrl: settings.default_share_image,\r\n    path: path\r\n  };\r\n}\r\n\r\nexport default {\r\n  getShareSettings,\r\n  getContentShareOptions,\r\n  getHomeShareOptions,\r\n  getDefaultShareOptions\r\n}; "],"names":["shareApi","uni"],"mappings":";;;AAMA,IAAI,gBAAgB;AAOb,eAAe,iBAAiB,eAAe,OAAO;AAE3D,MAAI,iBAAiB,CAAC,cAAc;AAClC,WAAO;AAAA,EACR;AAED,MAAI;AAEF,UAAM,SAAS,MAAMA,iBAAS;AAC9B,QAAI,UAAU,OAAO,SAAS,KAAK,OAAO,MAAM;AAE9C,sBAAgB,OAAO;AACvB,aAAO;AAAA,IACb,OAAW;AACLC,oBAAc,MAAA,MAAA,SAAA,wBAAA,aAAa,MAAM;AACjC,aAAO;AAAA,IACR;AAAA,EACF,SAAQ,OAAO;AACdA,kBAAc,MAAA,MAAA,SAAA,wBAAA,aAAa,KAAK;AAChC,WAAO;AAAA,EACR;AACH;AAOO,eAAe,uBAAuB,SAAS;AACpD,QAAM,WAAW,MAAM;AACvB,MAAI,CAAC,UAAU;AACb,WAAO;AAAA,MACL,OAAO;AAAA,MACP,MAAM;AAAA,IACZ;AAAA,EACG;AAGD,SAAO;AAAA,IACL,QAAO,mCAAS,UAAS,SAAS;AAAA,IAClC,WAAU,mCAAS,UAAS,SAAS;AAAA,IACrC,OAAM,mCAAS,MAAK,4BAA4B,QAAQ,EAAE,KAAK;AAAA,EACnE;AACA;AAMO,eAAe,sBAAsB;AAC1C,QAAM,WAAW,MAAM;AACvB,MAAI,CAAC,UAAU;AACb,WAAO;AAAA,MACL,OAAO;AAAA,MACP,MAAM;AAAA,IACZ;AAAA,EACG;AAED,SAAO;AAAA,IACL,OAAO,SAAS;AAAA,IAChB,UAAU,SAAS;AAAA,IACnB,MAAM;AAAA,EACV;AACA;AAOO,eAAe,uBAAuB,OAAO,sBAAsB;AACxE,QAAM,WAAW,MAAM;AACvB,MAAI,CAAC,UAAU;AACb,WAAO;AAAA,MACL,OAAO;AAAA,MACP;AAAA,IACN;AAAA,EACG;AAED,SAAO;AAAA,IACL,OAAO,SAAS;AAAA,IAChB,UAAU,SAAS;AAAA,IACnB;AAAA,EACJ;AACA;;;;;"}