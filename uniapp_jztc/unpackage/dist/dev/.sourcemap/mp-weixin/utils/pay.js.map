{"version":3,"file":"pay.js","sources":["utils/pay.js"],"sourcesContent":["/**\r\n * 支付工具函数\r\n */\r\nimport { unifiedOrder, orderPay } from '@/apis/pay'\r\n\r\n/**\r\n * 调用微信支付\r\n * @param {Object} data 支付参数\r\n * @param {String} data.body 商品描述\r\n * @param {String} data.orderNo 订单号\r\n * @param {Number} data.totalFee 订单金额\r\n * @returns {Promise} 支付结果Promise\r\n */\r\nexport function requestWxPay(data) {\r\n  return new Promise(async (resolve, reject) => {\r\n    try {\r\n      // 调用统一下单接口\r\n      const res = await unifiedOrder(data)\r\n      \r\n      if (res.code !== 0 || !res.data) {\r\n        throw new Error(res.message || '支付下单失败')\r\n      }\r\n      \r\n      // 获取支付参数\r\n      const payParams = res.data\r\n      \r\n      // 调用微信支付\r\n      uni.requestPayment({\r\n        provider: 'wxpay',\r\n        timeStamp: payParams.timeStamp,\r\n        nonceStr: payParams.nonceStr,\r\n        package: payParams.package,\r\n        signType: payParams.signType,\r\n        paySign: payParams.paySign,\r\n        success: function(res) {\r\n          resolve({\r\n            success: true,\r\n            message: '支付成功',\r\n            data: res\r\n          })\r\n        },\r\n        fail: function(err) {\r\n          // 判断用户取消\r\n          if (err.errMsg === 'requestPayment:fail cancel') {\r\n            resolve({\r\n              success: false,\r\n              message: '用户取消支付',\r\n              data: err\r\n            })\r\n          } else {\r\n            reject(new Error(err.errMsg || '支付失败'))\r\n          }\r\n        }\r\n      })\r\n    } catch (error) {\r\n      reject(error)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 调用订单支付\r\n * @param {Object} data 支付参数\r\n * @param {String} data.orderNo 订单号\r\n * @returns {Promise} 支付结果Promise\r\n */\r\nexport function requestOrderPay(data) {\r\n  return new Promise(async (resolve, reject) => {\r\n    try {\r\n      // 调用订单支付接口\r\n      const res = await orderPay(data)\r\n      \r\n      if (res.code !== 0 || !res.data) {\r\n        throw new Error(res.message || '支付下单失败')\r\n      }\r\n      \r\n      // 获取支付参数\r\n      const payParams = res.data\r\n      \r\n      // 调用微信支付\r\n      uni.requestPayment({\r\n        provider: 'wxpay',\r\n        timeStamp: payParams.timeStamp,\r\n        nonceStr: payParams.nonceStr,\r\n        package: payParams.package,\r\n        signType: payParams.signType,\r\n        paySign: payParams.paySign,\r\n        success: function(res) {\r\n          resolve({\r\n            success: true,\r\n            message: '支付成功',\r\n            data: res\r\n          })\r\n        },\r\n        fail: function(err) {\r\n          // 判断用户取消\r\n          if (err.errMsg === 'requestPayment:fail cancel') {\r\n            resolve({\r\n              success: false,\r\n              message: '用户取消支付',\r\n              data: err\r\n            })\r\n          } else {\r\n            reject(new Error(err.errMsg || '支付失败'))\r\n          }\r\n        }\r\n      })\r\n    } catch (error) {\r\n      reject(error)\r\n    }\r\n  })\r\n} "],"names":["unifiedOrder","uni","res","orderPay"],"mappings":";;;AAaO,SAAS,aAAa,MAAM;AACjC,SAAO,IAAI,QAAQ,OAAO,SAAS,WAAW;AAC5C,QAAI;AAEF,YAAM,MAAM,MAAMA,SAAY,aAAC,IAAI;AAEnC,UAAI,IAAI,SAAS,KAAK,CAAC,IAAI,MAAM;AAC/B,cAAM,IAAI,MAAM,IAAI,WAAW,QAAQ;AAAA,MACxC;AAGD,YAAM,YAAY,IAAI;AAGtBC,oBAAAA,MAAI,eAAe;AAAA,QACjB,UAAU;AAAA,QACV,WAAW,UAAU;AAAA,QACrB,UAAU,UAAU;AAAA,QACpB,SAAS,UAAU;AAAA,QACnB,UAAU,UAAU;AAAA,QACpB,SAAS,UAAU;AAAA,QACnB,SAAS,SAASC,MAAK;AACrB,kBAAQ;AAAA,YACN,SAAS;AAAA,YACT,SAAS;AAAA,YACT,MAAMA;AAAA,UAClB,CAAW;AAAA,QACF;AAAA,QACD,MAAM,SAAS,KAAK;AAElB,cAAI,IAAI,WAAW,8BAA8B;AAC/C,oBAAQ;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,MAAM;AAAA,YACpB,CAAa;AAAA,UACb,OAAiB;AACL,mBAAO,IAAI,MAAM,IAAI,UAAU,MAAM,CAAC;AAAA,UACvC;AAAA,QACF;AAAA,MACT,CAAO;AAAA,IACF,SAAQ,OAAO;AACd,aAAO,KAAK;AAAA,IACb;AAAA,EACL,CAAG;AACH;AAQO,SAAS,gBAAgB,MAAM;AACpC,SAAO,IAAI,QAAQ,OAAO,SAAS,WAAW;AAC5C,QAAI;AAEF,YAAM,MAAM,MAAMC,SAAQ,SAAC,IAAI;AAE/B,UAAI,IAAI,SAAS,KAAK,CAAC,IAAI,MAAM;AAC/B,cAAM,IAAI,MAAM,IAAI,WAAW,QAAQ;AAAA,MACxC;AAGD,YAAM,YAAY,IAAI;AAGtBF,oBAAAA,MAAI,eAAe;AAAA,QACjB,UAAU;AAAA,QACV,WAAW,UAAU;AAAA,QACrB,UAAU,UAAU;AAAA,QACpB,SAAS,UAAU;AAAA,QACnB,UAAU,UAAU;AAAA,QACpB,SAAS,UAAU;AAAA,QACnB,SAAS,SAASC,MAAK;AACrB,kBAAQ;AAAA,YACN,SAAS;AAAA,YACT,SAAS;AAAA,YACT,MAAMA;AAAA,UAClB,CAAW;AAAA,QACF;AAAA,QACD,MAAM,SAAS,KAAK;AAElB,cAAI,IAAI,WAAW,8BAA8B;AAC/C,oBAAQ;AAAA,cACN,SAAS;AAAA,cACT,SAAS;AAAA,cACT,MAAM;AAAA,YACpB,CAAa;AAAA,UACb,OAAiB;AACL,mBAAO,IAAI,MAAM,IAAI,UAAU,MAAM,CAAC;AAAA,UACvC;AAAA,QACF;AAAA,MACT,CAAO;AAAA,IACF,SAAQ,OAAO;AACd,aAAO,KAAK;AAAA,IACb;AAAA,EACL,CAAG;AACH;;;"}