{"version":3,"file":"wxapi.js","sources":["utils/wxapi.js"],"sourcesContent":["/**\r\n * 微信小程序API封装\r\n * 将原生API Promise化\r\n */\r\n\r\n/**\r\n * 获取微信登录凭证\r\n * @returns {Promise<string>} 登录凭证(code)\r\n */\r\nconst login = () => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.login({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        if (res.code) {\r\n          resolve(res.code);\r\n        } else {\r\n          reject(new Error(res.errMsg || '获取登录凭证失败'));\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '登录失败'));\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * 获取用户信息（基于button授权的方式）\r\n * @returns {Promise<Object>} 用户信息\r\n */\r\nconst getUserProfile = () => {\r\n  return new Promise((resolve, reject) => {\r\n    // #ifdef MP-WEIXIN\r\n    wx.getUserProfile({\r\n      desc: '用于完善用户资料',\r\n      success: (res) => {\r\n        resolve(res.userInfo);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '获取用户信息失败'));\r\n      }\r\n    });\r\n    // #endif\r\n    \r\n    // #ifndef MP-WEIXIN\r\n    uni.getUserInfo({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        resolve(res.userInfo);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error(err.errMsg || '获取用户信息失败'));\r\n      }\r\n    });\r\n    // #endif\r\n  });\r\n};\r\n\r\n/**\r\n * 检查是否已授权\r\n * @param {string} scope - 需要检查的权限\r\n * @returns {Promise<boolean>} 是否已授权\r\n */\r\nconst checkAuthorize = (scope) => {\r\n  return new Promise((resolve) => {\r\n    uni.getSetting({\r\n      success: (res) => {\r\n        if (res.authSetting[`scope.${scope}`]) {\r\n          resolve(true);\r\n        } else {\r\n          resolve(false);\r\n        }\r\n      },\r\n      fail: () => {\r\n        resolve(false);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport default {\r\n  login,\r\n  getUserProfile,\r\n  checkAuthorize\r\n}; "],"names":["uni","wx"],"mappings":";;AASA,MAAM,QAAQ,MAAM;AAClB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,MAAM;AAAA,MACR,UAAU;AAAA,MACV,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,MAAM;AACZ,kBAAQ,IAAI,IAAI;AAAA,QAC1B,OAAe;AACL,iBAAO,IAAI,MAAM,IAAI,UAAU,UAAU,CAAC;AAAA,QAC3C;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,eAAO,IAAI,MAAM,IAAI,UAAU,MAAM,CAAC;AAAA,MACvC;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAMA,MAAM,iBAAiB,MAAM;AAC3B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEtCC,kBAAAA,KAAG,eAAe;AAAA,MAChB,MAAM;AAAA,MACN,SAAS,CAAC,QAAQ;AAChB,gBAAQ,IAAI,QAAQ;AAAA,MACrB;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,eAAO,IAAI,MAAM,IAAI,UAAU,UAAU,CAAC;AAAA,MAC3C;AAAA,IACP,CAAK;AAAA,EAcL,CAAG;AACH;AAOA,MAAM,iBAAiB,CAAC,UAAU;AAChC,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9BD,kBAAAA,MAAI,WAAW;AAAA,MACb,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,YAAY,SAAS,KAAK,EAAE,GAAG;AACrC,kBAAQ,IAAI;AAAA,QACtB,OAAe;AACL,kBAAQ,KAAK;AAAA,QACd;AAAA,MACF;AAAA,MACD,MAAM,MAAM;AACV,gBAAQ,KAAK;AAAA,MACd;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAEA,MAAe,QAAA;AAAA,EACb;AAAA,EACA;AAAA,EACA;AACF;;"}