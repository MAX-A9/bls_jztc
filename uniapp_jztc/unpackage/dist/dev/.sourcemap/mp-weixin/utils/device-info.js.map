{"version":3,"file":"device-info.js","sources":["utils/device-info.js"],"sourcesContent":["/**\r\n * 设备信息工具\r\n * 统一封装设备信息相关API，解决兼容性问题\r\n */\r\n\r\n// 缓存获取的系统信息，避免重复调用API\r\nlet cachedWindowInfo = null;\r\nlet cachedDeviceInfo = null;\r\nlet cachedAppBaseInfo = null;\r\nlet cachedSystemSetting = null;\r\n\r\n/**\r\n * 获取窗口信息\r\n * @returns {Object} 窗口信息对象\r\n */\r\nexport function getWindowInfo() {\r\n  if (cachedWindowInfo) return cachedWindowInfo;\r\n  \r\n  try {\r\n    // 优先使用新API\r\n    if (uni.canIUse('getWindowInfo')) {\r\n      cachedWindowInfo = uni.getWindowInfo();\r\n      return cachedWindowInfo;\r\n    }\r\n    \r\n    // 回退到兼容方式\r\n    const sysInfo = uni.getSystemInfo({ sync: true });\r\n    cachedWindowInfo = {\r\n      windowWidth: sysInfo.windowWidth,\r\n      windowHeight: sysInfo.windowHeight,\r\n      screenWidth: sysInfo.screenWidth,\r\n      screenHeight: sysInfo.screenHeight,\r\n      statusBarHeight: sysInfo.statusBarHeight,\r\n      safeArea: sysInfo.safeArea || {\r\n        top: 0,\r\n        right: sysInfo.screenWidth,\r\n        bottom: sysInfo.screenHeight,\r\n        left: 0\r\n      },\r\n      pixelRatio: sysInfo.pixelRatio\r\n    };\r\n    return cachedWindowInfo;\r\n  } catch (error) {\r\n    console.error('获取窗口信息失败:', error);\r\n    // 返回默认值\r\n    return {\r\n      windowWidth: 375,\r\n      windowHeight: 667,\r\n      screenWidth: 375,\r\n      screenHeight: 667,\r\n      statusBarHeight: 20,\r\n      safeArea: {\r\n        top: 0,\r\n        right: 375,\r\n        bottom: 667,\r\n        left: 0\r\n      },\r\n      pixelRatio: 2\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 获取设备信息\r\n * @returns {Object} 设备信息对象\r\n */\r\nexport function getDeviceInfo() {\r\n  if (cachedDeviceInfo) return cachedDeviceInfo;\r\n  \r\n  try {\r\n    // 优先使用新API\r\n    if (uni.canIUse('getDeviceInfo')) {\r\n      cachedDeviceInfo = uni.getDeviceInfo();\r\n      return cachedDeviceInfo;\r\n    }\r\n    \r\n    // 回退到兼容方式\r\n    const sysInfo = uni.getSystemInfo({ sync: true });\r\n    cachedDeviceInfo = {\r\n      brand: sysInfo.brand,\r\n      model: sysInfo.model,\r\n      system: sysInfo.system,\r\n      platform: sysInfo.platform,\r\n      deviceId: sysInfo.deviceId,\r\n      devicePixelRatio: sysInfo.pixelRatio,\r\n      deviceOrientation: sysInfo.deviceOrientation,\r\n      deviceType: sysInfo.deviceType\r\n    };\r\n    return cachedDeviceInfo;\r\n  } catch (error) {\r\n    console.error('获取设备信息失败:', error);\r\n    // 返回默认值\r\n    return {\r\n      brand: '',\r\n      model: '',\r\n      system: '',\r\n      platform: '',\r\n      deviceId: '',\r\n      devicePixelRatio: 2,\r\n      deviceOrientation: 'portrait',\r\n      deviceType: 'phone'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 获取应用基础信息\r\n * @returns {Object} 应用基础信息对象\r\n */\r\nexport function getAppBaseInfo() {\r\n  if (cachedAppBaseInfo) return cachedAppBaseInfo;\r\n  \r\n  try {\r\n    // 优先使用新API\r\n    if (uni.canIUse('getAppBaseInfo')) {\r\n      cachedAppBaseInfo = uni.getAppBaseInfo();\r\n      return cachedAppBaseInfo;\r\n    }\r\n    \r\n    // 回退到兼容方式\r\n    const sysInfo = uni.getSystemInfo({ sync: true });\r\n    cachedAppBaseInfo = {\r\n      SDKVersion: sysInfo.SDKVersion,\r\n      appName: sysInfo.appName,\r\n      appVersion: sysInfo.version,\r\n      appLanguage: sysInfo.language,\r\n      theme: sysInfo.theme,\r\n      host: sysInfo.host\r\n    };\r\n    return cachedAppBaseInfo;\r\n  } catch (error) {\r\n    console.error('获取应用基础信息失败:', error);\r\n    // 返回默认值\r\n    return {\r\n      SDKVersion: '',\r\n      appName: '',\r\n      appVersion: '',\r\n      appLanguage: 'zh-Hans',\r\n      theme: 'light'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 获取系统设置\r\n * @returns {Object} 系统设置对象\r\n */\r\nexport function getSystemSetting() {\r\n  if (cachedSystemSetting) return cachedSystemSetting;\r\n  \r\n  try {\r\n    // 优先使用新API\r\n    if (uni.canIUse('getSystemSetting')) {\r\n      cachedSystemSetting = uni.getSystemSetting();\r\n      return cachedSystemSetting;\r\n    }\r\n    \r\n    // 回退到兼容方式\r\n    const sysInfo = uni.getSystemInfo({ sync: true });\r\n    cachedSystemSetting = {\r\n      bluetoothEnabled: sysInfo.bluetoothEnabled,\r\n      locationEnabled: sysInfo.locationEnabled,\r\n      wifiEnabled: sysInfo.wifiEnabled,\r\n      deviceOrientation: sysInfo.deviceOrientation,\r\n      // 兼容性处理\r\n      locationAuthorized: sysInfo.locationAuthorized,\r\n      microphoneAuthorized: sysInfo.microphoneAuthorized,\r\n      cameraAuthorized: sysInfo.cameraAuthorized,\r\n      notificationAuthorized: sysInfo.notificationAuthorized,\r\n      notificationAlertAuthorized: sysInfo.notificationAlertAuthorized,\r\n      notificationBadgeAuthorized: sysInfo.notificationBadgeAuthorized,\r\n      notificationSoundAuthorized: sysInfo.notificationSoundAuthorized,\r\n      bluetoothAuthorized: sysInfo.bluetoothAuthorized,\r\n    };\r\n    return cachedSystemSetting;\r\n  } catch (error) {\r\n    console.error('获取系统设置信息失败:', error);\r\n    // 返回默认值\r\n    return {\r\n      bluetoothEnabled: false,\r\n      locationEnabled: false,\r\n      wifiEnabled: true,\r\n      deviceOrientation: 'portrait'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 获取状态栏高度\r\n * @returns {Number} 状态栏高度(px)\r\n */\r\nexport function getStatusBarHeight() {\r\n  const windowInfo = getWindowInfo();\r\n  return windowInfo.statusBarHeight || 20;\r\n}\r\n\r\n/**\r\n * 获取导航栏高度\r\n * @returns {Number} 导航栏高度(px)\r\n */\r\nexport function getNavigationBarHeight() {\r\n  const statusBarHeight = getStatusBarHeight();\r\n  const deviceInfo = getDeviceInfo();\r\n  const isIOS = (deviceInfo.platform === 'ios') || \r\n    (/ios/i.test(deviceInfo.system || ''));\r\n  \r\n  // iOS 和 Android 导航栏高度不同\r\n  const navBarHeight = isIOS ? 44 : 48;\r\n  return statusBarHeight + navBarHeight;\r\n}\r\n\r\n/**\r\n * 获取安全区域\r\n * @returns {Object} 安全区域对象\r\n */\r\nexport function getSafeAreaInsets() {\r\n  const windowInfo = getWindowInfo();\r\n  const safeArea = windowInfo.safeArea || {};\r\n  \r\n  return {\r\n    top: safeArea.top || 0,\r\n    right: (windowInfo.screenWidth - safeArea.right) || 0,\r\n    bottom: (windowInfo.screenHeight - safeArea.bottom) || 0,\r\n    left: safeArea.left || 0\r\n  };\r\n}\r\n\r\n/**\r\n * 是否为 iPhone X 系列（有底部安全区域的机型）\r\n * @returns {Boolean} 是否为 iPhone X 系列\r\n */\r\nexport function isIphoneX() {\r\n  const deviceInfo = getDeviceInfo();\r\n  const safeAreaInsets = getSafeAreaInsets();\r\n  \r\n  return (deviceInfo.platform === 'ios' || \r\n    /ios/i.test(deviceInfo.system || '')) && \r\n    safeAreaInsets.bottom > 0;\r\n}\r\n\r\n/**\r\n * rpx 转 px\r\n * @param {Number} rpx - 要转换的rpx值\r\n * @returns {Number} 转换后的px值\r\n */\r\nexport function rpx2px(rpx) {\r\n  const windowInfo = getWindowInfo();\r\n  return (rpx / 750) * windowInfo.windowWidth;\r\n}\r\n\r\n/**\r\n * px 转 rpx\r\n * @param {Number} px - 要转换的px值\r\n * @returns {Number} 转换后的rpx值\r\n */\r\nexport function px2rpx(px) {\r\n  const windowInfo = getWindowInfo();\r\n  return (px * 750) / windowInfo.windowWidth;\r\n}\r\n\r\n// 导出默认对象，方便一次性导入所有方法\r\nexport default {\r\n  getWindowInfo,\r\n  getDeviceInfo,\r\n  getAppBaseInfo,\r\n  getSystemSetting,\r\n  getStatusBarHeight,\r\n  getNavigationBarHeight,\r\n  getSafeAreaInsets,\r\n  isIphoneX,\r\n  rpx2px,\r\n  px2rpx\r\n}; "],"names":["uni","deviceInfo"],"mappings":"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"}