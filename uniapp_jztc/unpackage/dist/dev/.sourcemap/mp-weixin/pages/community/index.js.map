{"version":3,"file":"index.js","sources":["pages/community/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tbXVuaXR5L2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"community-container\">\n\t\t<!-- 自定义顶部栏 -->\n\t\t<view class=\"custom-nav\" :style=\"{ paddingTop: statusBarHeight + 'px' }\">\n\t\t\t<view class=\"nav-content\" :style=\"{ \n\t\t\t\theight: navBarHeight + 'px',\n\t\t\t\tpaddingRight: rightPadding + 'px'\n\t\t\t}\">\n\t\t\t\t<text class=\"page-title\">闲置</text>\n\t\t\t\t<view class=\"search-box\" @click=\"handleSearch\" :style=\"{ width: searchBoxWidth + 'px' }\">\n\t\t\t\t\t<uni-icons type=\"search\" size=\"16\" color=\"#666666\"></uni-icons>\n\t\t\t\t\t<text class=\"placeholder-text\">搜索闲置商品</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 内容区域 -->\n\t\t<view class=\"page-content\" :style=\"{ paddingTop: navigationBarHeight + 'px' }\">\n\t\t\t<!-- 菜单导航 -->\n\t\t\t<view class=\"menu-nav\">\n\t\t\t\t<scroll-view \n\t\t\t\t\tclass=\"menu-scroll\" \n\t\t\t\t\tscroll-x=\"true\" \n\t\t\t\t\t:show-scrollbar=\"false\"\n\t\t\t\t>\n\t\t\t\t\t<view class=\"menu-list\">\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tv-for=\"(item, index) in menuList\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\tclass=\"menu-item\"\n\t\t\t\t\t\t\t:class=\"{ active: currentMenu === index }\"\n\t\t\t\t\t\t\t@click=\"switchMenu(index)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text class=\"menu-text\">{{ item.name }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 修改滚动区域结构 -->\n\t\t\t<scroll-view \n\t\t\t\tclass=\"content-scroll\" \n\t\t\t\tscroll-y=\"true\"\n\t\t\t\t:enhanced=\"true\"\n\t\t\t\t:bounces=\"true\"\n\t\t\t\t:show-scrollbar=\"false\"\n\t\t\t\t:refresher-enabled=\"true\"\n\t\t\t\t:refresher-triggered=\"isRefreshing\"\n\t\t\t\t@refresherrefresh=\"onRefresh\"\n\t\t\t\t@refresherrestore=\"onRestore\"\n\t\t\t\t@scrolltolower=\"handleScrollToLower\"\n\t\t\t>\n\t\t\t\t<view class=\"content-wrapper\">\n\t\t\t\t\t<community-news ref=\"newsComponent\"></community-news>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<!-- 底部导航栏 -->\n\t\t<tab-bar :current-tab=\"tabIndex\"></tab-bar>\n\t</view>\n</template>\n\n<script>\n\timport TabBar from '@/components/tab-bar/index.vue'\n\timport CommunityNews from '@/components/community-news/index.vue'\n\timport deviceMixin from '@/mixins/device.js'\n\timport shareMixin from '@/mixins/share.js'\n\timport { get } from '@/utils/request.js'\n\timport { addBrowseRecord } from '@/apis/content.js'\n\timport { getShareSettings } from '@/utils/share.js'\n\t\n\texport default {\n\t\tcomponents: {\n\t\t\tTabBar,\n\t\t\tCommunityNews\n\t\t},\n\t\tmixins: [deviceMixin, shareMixin],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttabIndex: 1,\n\t\t\t\tisRefreshing: false,\n\t\t\t\tcurrentMenu: 0,\n\t\t\t\tsearchBoxWidth: 200,\n\t\t\t\trightPadding: 0,\n\t\t\t\tmenuList: [],\n\t\t\t\tmenuLoading: false,\n\t\t\t\tisHomePage: true, // 标记为首页类型，用于分享功能\n\t\t\t\tshareData: null\n\t\t\t}\n\t\t},\n\t\tonLoad() {\n\t\t\t// 获取闲置物品分类\n\t\t\tthis.fetchCategories()\n\t\t},\n\t\tmounted() {\n\t\t\t// 计算搜索框宽度和右侧边距\n\t\t\tconst menuButtonInfo = uni.getMenuButtonBoundingClientRect()\n\t\t\tconst windowInfo = uni.getWindowInfo()\n\t\t\t\n\t\t\t// 计算搜索框宽度，减少标题占用的空间\n\t\t\tthis.searchBoxWidth = menuButtonInfo.left - 100\n\t\t\t\n\t\t\t// 设置右侧边距，与胶囊对齐\n\t\t\tthis.rightPadding = windowInfo.windowWidth - menuButtonInfo.left\n\t\t},\n\t\tonShow() {\n\t\t\tthis.tabIndex = 1\n\t\t\t\n\t\t\t// 更新分享数据\n\t\t\tthis.updateShareData()\n\t\t},\n\t\tmethods: {\n\t\t\t// 获取闲置分类数据\n\t\t\tfetchCategories() {\n\t\t\t\tthis.menuLoading = true\n\t\t\t\t\n\t\t\t\t// 添加默认全部选项\n\t\t\t\tconst defaultMenu = {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tname: '全部'\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 添加超时处理\n\t\t\t\tconst fetchTimeout = setTimeout(() => {\n\t\t\t\t\tif (this.menuLoading) {\n\t\t\t\t\t\t// 超时后使用默认菜单并关闭加载状态\n\t\t\t\t\t\tthis.useDefaultMenu()\n\t\t\t\t\t\tthis.menuLoading = false\n\t\t\t\t\t\tconsole.log('获取闲置分类超时，使用默认值')\n\t\t\t\t\t}\n\t\t\t\t}, 3000)\n\t\t\t\t\n\t\t\t\t// 调用接口获取分类数据\n\t\t\t\tget('/wx/client/content/categories', { type: 2 })\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tclearTimeout(fetchTimeout)\n\t\t\t\t\t\tif (res.code === 0) {\n\t\t\t\t\t\t\t// 处理返回数据\n\t\t\t\t\t\t\tconst categoryList = res.data.list || []\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 将全部选项添加到列表最前面\n\t\t\t\t\t\t\tthis.menuList = [defaultMenu, ...categoryList]\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconsole.log('成功获取闲置分类:', this.menuList)\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 更新分享数据\n\t\t\t\t\t\t\tthis.updateShareData()\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error('获取闲置分类失败:', res.message || '未知错误')\n\t\t\t\t\t\t\t// 加载失败时使用默认菜单\n\t\t\t\t\t\t\tthis.useDefaultMenu()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tclearTimeout(fetchTimeout)\n\t\t\t\t\t\tconsole.error('请求闲置分类接口出错:', err)\n\t\t\t\t\t\t// 加载失败时使用默认菜单\n\t\t\t\t\t\tthis.useDefaultMenu()\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tclearTimeout(fetchTimeout)\n\t\t\t\t\t\tthis.menuLoading = false\n\t\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\t// 接口失败时使用默认菜单\n\t\t\tuseDefaultMenu() {\n\t\t\t\t// 使用空数组，只保留\"全部\"选项\n\t\t\t\tthis.menuList = [\n\t\t\t\t\t{ id: 0, name: '全部' }\n\t\t\t\t]\n\t\t\t},\n\t\t\t\n\t\t\thandleSearch() {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: '/pages/search/index'\n\t\t\t\t})\n\t\t\t},\n\t\t\tswitchMenu(index) {\n\t\t\t\tthis.currentMenu = index\n\t\t\t\t\n\t\t\t\t// 获取选中分类的ID\n\t\t\t\tconst selectedCategory = this.menuList[index]\n\t\t\t\tconst categoryId = selectedCategory ? selectedCategory.id : 0\n\t\t\t\t\n\t\t\t\t// 发送分类变更事件，通知内容组件更新\n\t\t\t\tuni.$emit('idleCategoryChanged', { categoryId: categoryId })\n\t\t\t\t\n\t\t\t\tconsole.log('切换到分类:', selectedCategory.name, 'ID:', categoryId)\n\t\t\t},\n\t\t\tasync onRefresh() {\n\t\t\t\tif (this.isRefreshing) return\n\t\t\t\tthis.isRefreshing = true\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// 刷新分类数据\n\t\t\t\t\tthis.fetchCategories()\n\t\t\t\t\t\n\t\t\t\t\t// 刷新内容组件数据\n\t\t\t\t\tif (this.$refs.newsComponent) {\n\t\t\t\t\t\tthis.$refs.newsComponent.resetAndLoad()\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tawait this.refreshData()\n\t\t\t\t\t\n\t\t\t\t\t// 更新分享数据\n\t\t\t\t\tthis.updateShareData()\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('刷新失败:', error)\n\t\t\t\t} finally {\n\t\t\t\t\tthis.isRefreshing = false\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync refreshData() {\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000))\n\t\t\t},\n\t\t\t// 处理上拉加载更多\n\t\t\thandleScrollToLower() {\n\t\t\t\tconsole.log('触发上拉加载更多')\n\t\t\t\t// 调用内容组件的加载更多方法\n\t\t\t\tif (this.$refs.newsComponent) {\n\t\t\t\t\tthis.$refs.newsComponent.loadMore()\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 更新分享数据\n\t\t\tasync updateShareData() {\n\t\t\t\ttry {\n\t\t\t\t\t// 获取分享配置\n\t\t\t\t\tconst settings = await getShareSettings();\n\t\t\t\t\t\n\t\t\t\t\tif (settings) {\n\t\t\t\t\t\t// 使用闲置社区专用的分享设置\n\t\t\t\t\t\tconst shareTitle = settings.content_share_text || '查看闲置社区';\n\t\t\t\t\t\tconst shareImage = settings.content_share_image || '';\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 直接设置分享数据\n\t\t\t\t\t\tthis.shareData = {\n\t\t\t\t\t\t\ttitle: shareTitle,\n\t\t\t\t\t\t\timageUrl: shareImage,\n\t\t\t\t\t\t\tpath: '/pages/community/index'\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log('闲置社区分享数据已更新:', this.shareData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 配置获取失败，调用混入的默认初始化\n\t\t\t\t\t\tthis.initShareData();\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('更新分享数据失败:', error);\n\t\t\t\t\t// 配置获取失败，调用混入的默认初始化\n\t\t\t\t\tthis.initShareData();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 显示分享菜单\n\t\t\thandleShare() {\n\t\t\t\t// 更新分享数据\n\t\t\t\tthis.updateShareData();\n\t\t\t\t// 显示分享菜单，包括分享朋友圈\n\t\t\t\tuni.showShareMenu({\n\t\t\t\t\twithShareTicket: true,\n\t\t\t\t\tmenus: ['shareAppMessage', 'shareTimeline']\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t/* 添加全局变量 */\n\tpage {\n\t\t--menu-height: 88rpx;\n\t\t--tab-bar-height: 100rpx;\n\t\t--safe-bottom: env(safe-area-inset-bottom);\n\t}\n\n\t.community-container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\theight: 100vh;\n\t\tbackground-color: #f5f5f5;\n\t\toverflow: hidden;\n\t}\n\t\n\t/* 自定义导航栏样式 */\n\t.custom-nav {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tz-index: 100;\n\t\tbackground: linear-gradient(180deg, #fc3e2b 0%, #fa7154 101%);\n\t}\n\t\n\t.nav-content {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding-left: 24rpx;\n\t\tgap: 12rpx;\n\t}\n\t\n\t.page-title {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #ffffff;\n\t\tflex-shrink: 0;\n\t\tmargin-right: 12rpx;\n\t\twidth: 64rpx;\n\t}\n\t\n\t.search-box {\n\t\theight: 64rpx;\n\t\tbackground-color: rgba(255, 255, 255, 0.9);\n\t\tborder-radius: 32rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 0 24rpx;\n\t\tgap: 8rpx;\n\t}\n\t\n\t.placeholder-text {\n\t\tfont-size: 26rpx;\n\t\tcolor: #999999;\n\t}\n\t\n\t.page-content {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tposition: relative;\n\t\tz-index: 1;\n\t\tmargin-top: -20rpx;\n\t\tbackground-color: #fa7154;\n\t\t/* 确保内容区域高度正确 */\n\t\theight: calc(100vh - var(--window-top));\n\t}\n\t\n\t/* 移除之前的渐变背景 */\n\t.page-content::before {\n\t\tdisplay: none;\n\t}\n\t\n\t/* 菜单导航样式 */\n\t.menu-nav {\n\t\tbackground-color: #ffffff;\n\t\tborder-top-left-radius: 30rpx;\n\t\tborder-top-right-radius: 30rpx;\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tz-index: 2;\n\t\tmargin-top: 20rpx;\n\t}\n\t\n\t.menu-scroll {\n\t\twidth: 100%;\n\t\twhite-space: nowrap;\n\t}\n\t\n\t.menu-list {\n\t\tdisplay: flex;\n\t\tpadding: 0 16rpx;\n\t\theight: 88rpx;\n\t}\n\t\n\t.menu-item {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 0 12rpx;\n\t\tposition: relative;\n\t}\n\t\n\t.menu-text {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333333;\n\t\tline-height: 88rpx;\n\t\tpadding: 0 4rpx;\n\t}\n\t\n\t.menu-item.active .menu-text {\n\t\tcolor: #fc3e2b;\n\t\tfont-weight: bold;\n\t}\n\t\n\t.menu-item.active::after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tbottom: 16rpx;\n\t\tleft: 50%;\n\t\ttransform: translateX(-50%);\n\t\twidth: 32rpx;\n\t\theight: 4rpx;\n\t\tbackground-color: #fc3e2b;\n\t\tborder-radius: 2rpx;\n\t}\n\t\n\t.content-scroll {\n\t\tflex: 1;\n\t\tbackground-color: #ffffff;\n\t\t/* 调整上边距和内边距 */\n\t\tmargin-top: -20rpx;\n\t\tpadding-top: 20rpx;\n\t\t/* 使用更精确的高度计算 */\n\t\theight: calc(100% - var(--menu-height));\n\t\t/* 添加溢出处理 */\n\t\toverflow: hidden;\n\t}\n\t\n\t.content-wrapper {\n\t\tmin-height: 100%;\n\t\t/* 使用更可靠的底部内边距计算 */\n\t\tpadding-bottom: calc(var(--safe-bottom) + var(--tab-bar-height) + 40rpx);\n\t}\n\t\n\t.content-list {\n\t\tpadding: 0;\n\t}\n</style>\n","import MiniProgramPage from 'E:/Myxiangmu/chonggou/juzitongcheng/pages/community/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["deviceMixin","shareMixin","uni","get","getShareSettings"],"mappings":"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"}