{"version":3,"file":"index.js","sources":["pages/publish/draft/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHVibGlzaC9kcmFmdC9pbmRleC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"draft-container\">\r\n\t\t<!-- 自定义导航栏 -->\r\n\t\t<view class=\"nav-bar\" :style=\"{ paddingTop: statusBarHeight + 'px' }\">\r\n\t\t\t<view class=\"nav-content\" :style=\"{ height: navBarHeight + 'px' }\">\r\n\t\t\t\t<view class=\"back-btn\" @tap=\"handleBack\">\r\n\t\t\t\t\t<uni-icons type=\"left\" size=\"20\" color=\"#333333\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"nav-title\">草稿箱</text>\r\n\t\t\t\t<view class=\"right-btn\" @tap=\"handleClearAll\" v-if=\"draftList.length > 0\">\r\n\t\t\t\t\t<text class=\"clear-text\">清空</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 占位元素 -->\r\n\t\t<view class=\"placeholder\" :style=\"{ height: `calc(${statusBarHeight}px + ${navBarHeight}px)` }\"></view>\r\n\t\t\r\n\t\t<!-- 草稿列表 -->\r\n\t\t<view class=\"draft-list\" v-if=\"draftList.length > 0\">\r\n\t\t\t<view\r\n\t\t\t\tclass=\"draft-item\"\r\n\t\t\t\tv-for=\"item in draftList\"\r\n\t\t\t\t:key=\"item.id\"\r\n\t\t\t\t@tap=\"handleDraftClick(item)\"\r\n\t\t\t>\r\n\t\t\t\t<view class=\"draft-info\">\r\n\t\t\t\t\t<view class=\"draft-title\">{{ getTitlePreview(item) }}</view>\r\n\t\t\t\t\t<view class=\"draft-meta\">\r\n\t\t\t\t\t\t<text class=\"draft-type\">{{ item.type === 'idle' ? '闲置' : '信息' }}</text>\r\n\t\t\t\t\t\t<text class=\"draft-time\">{{ formatTime(item.updateTime) }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"draft-actions\">\r\n\t\t\t\t\t<view class=\"delete-btn\" @tap.stop=\"handleDeleteDraft(item)\">\r\n\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"18\" color=\"#ff4500\"></uni-icons>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 空状态 -->\r\n\t\t<view class=\"empty-state\" v-else>\r\n\t\t\t<image class=\"empty-icon\" src=\"/static/images/icons/empty.png\" mode=\"aspectFit\"></image>\r\n\t\t\t<text class=\"empty-text\">暂无草稿</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport deviceMixin from '@/mixins/device.js'\r\n\timport { getIdleDrafts, getInfoDrafts, deleteIdleDraft, deleteInfoDraft, getAllDraftList } from '@/utils/storage.js'\r\n\timport deviceInfo from '@/utils/device-info.js'\r\n\t\r\n\texport default {\r\n\t\tmixins: [deviceMixin],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tstatusBarHeight: 0,\r\n\t\t\t\tnavBarHeight: 44,\r\n\t\t\t\tdraftList: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 获取状态栏高度\r\n\t\t\tthis.statusBarHeight = deviceInfo.getStatusBarHeight();\r\n\t\t\t\r\n\t\t\t// 加载草稿数据\r\n\t\t\tthis.loadDraftList()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 返回上一页\r\n\t\t\thandleBack() {\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 加载草稿列表\r\n\t\t\tloadDraftList() {\r\n\t\t\t\tthis.draftList = getAllDraftList()\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 格式化时间显示\r\n\t\t\tformatTime(timeStr) {\r\n\t\t\t\tif (!timeStr) return '未知时间'\r\n\t\t\t\t\r\n\t\t\t\tconst date = new Date(timeStr)\r\n\t\t\t\tconst now = new Date()\r\n\t\t\t\tconst diff = now - date\r\n\t\t\t\t\r\n\t\t\t\t// 一小时内\r\n\t\t\t\tif (diff < 3600000) {\r\n\t\t\t\t\tconst minutes = Math.floor(diff / 60000)\r\n\t\t\t\t\treturn `${minutes === 0 ? '刚刚' : minutes + '分钟前'}`\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 一天内\r\n\t\t\t\tif (diff < 86400000) {\r\n\t\t\t\t\tconst hours = Math.floor(diff / 3600000)\r\n\t\t\t\t\treturn `${hours}小时前`\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 一周内\r\n\t\t\t\tif (diff < 604800000) {\r\n\t\t\t\t\tconst days = Math.floor(diff / 86400000)\r\n\t\t\t\t\treturn `${days}天前`\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 超过一周\r\n\t\t\t\treturn `${date.getMonth() + 1}月${date.getDate()}日`\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 获取标题预览（如果没有标题则显示描述的一部分）\r\n\t\t\tgetTitlePreview(draft) {\r\n\t\t\t\tif (draft.title && draft.title.trim()) {\r\n\t\t\t\t\treturn draft.title\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (draft.description && draft.description.trim()) {\r\n\t\t\t\t\tconst preview = draft.description.slice(0, 20)\r\n\t\t\t\t\treturn preview.length >= 20 ? preview + '...' : preview\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn draft.type === 'idle' ? '闲置物品草稿' : '信息发布草稿'\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 处理草稿点击，根据类型跳转到不同页面\r\n\t\t\thandleDraftClick(draft) {\r\n\t\t\t\tif (draft.type === 'idle') {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: `/pages/publish/idle/index?draftId=${draft.id}`\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: `/pages/publish/info/index?draftId=${draft.id}`\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 处理删除草稿\r\n\t\t\thandleDeleteDraft(draft) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确定要删除该草稿吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tlet success = false\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (draft.type === 'idle') {\r\n\t\t\t\t\t\t\t\tsuccess = deleteIdleDraft(draft.id)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsuccess = deleteInfoDraft(draft.id)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (success) {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '删除成功',\r\n\t\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// 重新加载列表\r\n\t\t\t\t\t\t\t\tthis.loadDraftList()\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '删除失败',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 清空所有草稿\r\n\t\t\thandleClearAll() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确定要清空所有草稿吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t// 遍历删除所有草稿\r\n\t\t\t\t\t\t\tthis.draftList.forEach(draft => {\r\n\t\t\t\t\t\t\t\tif (draft.type === 'idle') {\r\n\t\t\t\t\t\t\t\t\tdeleteIdleDraft(draft.id)\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdeleteInfoDraft(draft.id)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 清空列表\r\n\t\t\t\t\t\t\tthis.draftList = []\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '清空成功',\r\n\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.draft-container {\r\n\t\tpadding-bottom: 30rpx;\r\n\t\tbackground-color: #f8f8f8;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\t\r\n\t.nav-bar {\r\n\t\tbackground-color: #ffffff;\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 99;\r\n\t\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.04);\r\n\t}\r\n\t\r\n\t.nav-content {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tposition: relative;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.back-btn {\r\n\t\tposition: absolute;\r\n\t\tleft: 20rpx;\r\n\t\tpadding: 10rpx;\r\n\t}\r\n\t\r\n\t.right-btn {\r\n\t\tposition: absolute;\r\n\t\tright: 30rpx;\r\n\t\tz-index: 10;\r\n\t}\r\n\t\r\n\t.clear-text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666666;\r\n\t}\r\n\t\r\n\t.nav-title {\r\n\t\tfont-size: 34rpx;\r\n\t\tfont-weight: 500;\r\n\t\tcolor: #333333;\r\n\t\tmax-width: 350rpx;\r\n\t\ttext-align: center;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t\r\n\t.placeholder {\r\n\t\twidth: 100%;\r\n\t}\r\n\t\r\n\t.draft-list {\r\n\t\tpadding: 20rpx 30rpx;\r\n\t}\r\n\t\r\n\t.draft-item {\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 30rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n\t}\r\n\t\r\n\t.draft-info {\r\n\t\tflex: 1;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t\r\n\t.draft-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #333333;\r\n\t\tmargin-bottom: 16rpx;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t\r\n\t.draft-meta {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.draft-type {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #ffffff;\r\n\t\tbackground-color: #ff8c00;\r\n\t\tpadding: 6rpx 12rpx;\r\n\t\tborder-radius: 6rpx;\r\n\t\tmargin-right: 16rpx;\r\n\t}\r\n\t\r\n\t.draft-time {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999999;\r\n\t}\r\n\t\r\n\t.draft-actions {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\t\r\n\t.delete-btn {\r\n\t\tpadding: 10rpx;\r\n\t}\r\n\t\r\n\t.empty-state {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding-top: 200rpx;\r\n\t}\r\n\t\r\n\t.empty-icon {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tmargin-bottom: 30rpx;\r\n\t}\r\n\t\r\n\t.empty-text {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #999999;\r\n\t}\r\n</style> ","import MiniProgramPage from 'E:/Myxiangmu/chonggou/juzitongcheng/pages/publish/draft/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["deviceMixin","deviceInfo","uni","getAllDraftList","deleteIdleDraft","deleteInfoDraft"],"mappings":"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"}