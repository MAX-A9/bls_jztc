{"version":3,"file":"index.js","sources":["pages/my/follow/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXkvZm9sbG93L2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 用户关注列表 -->\r\n\t\t<scroll-view \r\n\t\t\tclass=\"content-scroll\" \r\n\t\t\tscroll-y \r\n\t\t\t:refresher-enabled=\"true\"\r\n\t\t\t:refresher-triggered=\"isRefreshing\"\r\n\t\t\t@refresherrefresh=\"onRefresh\"\r\n\t\t\t:show-scrollbar=\"false\"\r\n\t\t\t@scrolltolower=\"loadMore\"\r\n\t\t>\r\n\t\t\t<!-- 加载中 -->\r\n\t\t\t<view class=\"loading-container\" v-if=\"loading && userList.length === 0\">\r\n\t\t\t\t<view class=\"loading-indicator\"></view>\r\n\t\t\t\t<text class=\"loading-text\">数据加载中...</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"follow-list\" v-if=\"userList.length > 0\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tclass=\"user-item\"\r\n\t\t\t\t\tv-for=\"(item, index) in userList\"\r\n\t\t\t\t\t:key=\"item.client_id\"\r\n\t\t\t\t\t@tap=\"handleUserClick(item)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<image class=\"user-avatar\" :src=\"item.avatar_url || '/static/avatar/default.png'\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"user-info\">\r\n\t\t\t\t\t\t<text class=\"user-name\">{{ item.real_name }}</text>\r\n\t\t\t\t\t\t<view class=\"user-meta\">\r\n\t\t\t\t\t\t\t<text class=\"publish-count\">已发布 {{ item.publish_count || 0 }} 条</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<button class=\"follow-btn\" @tap.stop=\"toggleFollow(item, index)\">已关注</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 加载更多 -->\r\n\t\t\t\t<view class=\"loading-more\" v-if=\"hasMore && !loading\">\r\n\t\t\t\t\t<text class=\"loading-text\">上拉加载更多</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"loading-more\" v-if=\"loading && userList.length > 0\">\r\n\t\t\t\t\t<text class=\"loading-text\">加载中...</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"loading-more\" v-if=\"!hasMore && userList.length > 0\">\r\n\t\t\t\t\t<text class=\"loading-text\">没有更多数据了</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 空状态 -->\r\n\t\t\t<view class=\"empty-state\" v-if=\"!loading && userList.length === 0\">\r\n\t\t\t\t<image class=\"empty-image\" src=\"/static/images/empty.png\" mode=\"aspectFit\"></image>\r\n\t\t\t\t<text class=\"empty-text\">暂无关注内容</text>\r\n\t\t\t\t<button class=\"action-btn\" @tap=\"handleExplore\">去发现</button>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport { getFollowingList, unfollowUser } from '@/apis/content.js'\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tisRefreshing: false,\r\n\t\t\t\tloading: false,\r\n\t\t\t\tuserList: [],\r\n\t\t\t\tcurrentPage: 1,\r\n\t\t\t\tpageSize: 10,\r\n\t\t\t\thasMore: true,\r\n\t\t\t\ttotal: 0\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 加载关注列表\r\n\t\t\tthis.loadFollowingList()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 加载关注列表\r\n\t\t\tasync loadFollowingList() {\r\n\t\t\t\tif (this.loading) return\r\n\t\t\t\t\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst result = await getFollowingList({\r\n\t\t\t\t\t\tpage: this.currentPage,\r\n\t\t\t\t\t\tsize: this.pageSize\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.code === 0 && result.data) {\r\n\t\t\t\t\t\t// 第一页时直接赋值，加载更多时追加\r\n\t\t\t\t\t\tif (this.currentPage === 1) {\r\n\t\t\t\t\t\t\tthis.userList = result.data.list || []\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.userList = [...this.userList, ...(result.data.list || [])]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新总数和判断是否有更多\r\n\t\t\t\t\t\tthis.total = result.data.total || 0\r\n\t\t\t\t\t\tthis.hasMore = this.userList.length < this.total\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.message || '加载失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('加载关注列表失败:', error)\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '网络异常，请稍后重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (this.isRefreshing) {\r\n\t\t\t\t\t\tthis.isRefreshing = false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 下拉刷新\r\n\t\t\tasync onRefresh() {\r\n\t\t\t\tthis.isRefreshing = true\r\n\t\t\t\tthis.currentPage = 1\r\n\t\t\t\tawait this.loadFollowingList()\r\n\t\t\t\t\r\n\t\t\t\t// 防止加载成功但数据为空时无法触发刷新完成\r\n\t\t\t\tif (this.isRefreshing) {\r\n\t\t\t\t\tthis.isRefreshing = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 加载更多\r\n\t\t\tloadMore() {\r\n\t\t\t\tif (this.loading || !this.hasMore) return\r\n\t\t\t\t\r\n\t\t\t\tthis.currentPage++\r\n\t\t\t\tthis.loadFollowingList()\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 点击用户进入详情\r\n\t\t\thandleUserClick(user) {\r\n\t\t\t\tif (!user || !user.client_id) return\r\n\t\t\t\t\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: `/pages/user/detail?id=${user.client_id}`\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 取消关注\r\n\t\t\tasync toggleFollow(user, index) {\r\n\t\t\t\tif (!user || !user.client_id) return\r\n\t\t\t\t\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确定要取消关注吗？',\r\n\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t// 显示加载提示\r\n\t\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\t\ttitle: '处理中...',\r\n\t\t\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// 调用取消关注接口\r\n\t\t\t\t\t\t\t\tconst result = await unfollowUser({\r\n\t\t\t\t\t\t\t\t\tpublisher_id: user.client_id\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// 关闭加载提示\r\n\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (result && result.code === 0) {\r\n\t\t\t\t\t\t\t\t\t// 成功后从列表中移除\r\n\t\t\t\t\t\t\t\t\tthis.userList.splice(index, 1)\r\n\t\t\t\t\t\t\t\t\tthis.total--\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '已取消关注',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthrow new Error(result?.message || '操作失败')\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\tconsole.error('取消关注失败:', error)\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: error.message || '操作失败，请重试',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 跳转到发现页\r\n\t\t\thandleExplore() {\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #ffffff;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t\r\n\t.content-scroll {\r\n\t\tflex: 1;\r\n\t\theight: 100vh;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\t\r\n\t.follow-list {\r\n\t\tpadding: 0;\r\n\t}\r\n\t\r\n\t.user-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 24rpx 30rpx;\r\n\t\tborder-bottom: 1rpx solid #f5f5f5;\r\n\t}\r\n\t\r\n\t.user-avatar {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 20rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\t\r\n\t.user-info {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t\r\n\t.user-name {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #333333;\r\n\t\tfont-weight: 500;\r\n\t\tmargin-bottom: 6rpx;\r\n\t}\r\n\t\r\n\t.user-meta {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.publish-count {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999999;\r\n\t\tmargin-right: 16rpx;\r\n\t}\r\n\t\r\n\t.follow-btn {\r\n\t\tmin-width: 100rpx;\r\n\t\theight: 56rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tborder-radius: 28rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tmargin: 0;\r\n\t\tpadding: 0 20rpx;\r\n\t\tbackground: linear-gradient(135deg, #fc3e2b 0%, #fa7154 100%);\r\n\t\tcolor: #ffffff;\r\n\t\tborder: none;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\t\r\n\t.follow-btn:active {\r\n\t\topacity: 0.8;\r\n\t}\r\n\t\r\n\t.empty-state {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding-top: 200rpx;\r\n\t}\r\n\t\r\n\t.empty-image {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tmargin-bottom: 30rpx;\r\n\t}\r\n\t\r\n\t.empty-text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #999999;\r\n\t\tmargin-bottom: 40rpx;\r\n\t}\r\n\t\r\n\t.action-btn {\r\n\t\twidth: 240rpx;\r\n\t\theight: 80rpx;\r\n\t\tbackground-color: #fc3e2b;\r\n\t\tcolor: #ffffff;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 40rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.loading-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 60rpx 0;\r\n\t}\r\n\t\r\n\t.loading-indicator {\r\n\t\twidth: 40rpx;\r\n\t\theight: 40rpx;\r\n\t\tborder: 4rpx solid #f0f0f0;\r\n\t\tborder-radius: 50%;\r\n\t\tborder-top-color: #fc3e2b;\r\n\t\tanimation: spin 1s linear infinite;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\t\r\n\t@keyframes spin {\r\n\t\t0% { transform: rotate(0deg); }\r\n\t\t100% { transform: rotate(360deg); }\r\n\t}\r\n\t\r\n\t.loading-text {\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #999999;\r\n\t}\r\n\t\r\n\t.loading-more {\r\n\t\ttext-align: center;\r\n\t\tpadding: 20rpx 0;\r\n\t}\r\n</style> ","import MiniProgramPage from 'E:/Myxiangmu/chonggou/juzitongcheng/pages/my/follow/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getFollowingList","uni","unfollowUser"],"mappings":"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"}