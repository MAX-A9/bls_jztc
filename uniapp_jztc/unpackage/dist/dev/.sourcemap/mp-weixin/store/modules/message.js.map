{"version":3,"file":"message.js","sources":["store/modules/message.js"],"sourcesContent":["import { getUnreadCount } from '@/apis/message.js';\r\n\r\n// 消息模块状态管理\r\nconst state = {\r\n  unreadCount: 0,  // 未读消息总数\r\n  lastFetchTime: 0  // 上次获取未读消息的时间戳\r\n};\r\n\r\nconst mutations = {\r\n  // 设置未读消息数量\r\n  SET_UNREAD_COUNT(state, count) {\r\n    state.unreadCount = count;\r\n  },\r\n  // 更新获取时间戳\r\n  UPDATE_FETCH_TIME(state) {\r\n    state.lastFetchTime = Date.now();\r\n  }\r\n};\r\n\r\nconst actions = {\r\n  // 获取未读消息数量\r\n  async getUnreadCount({ commit, state }) {\r\n    try {\r\n      // 如果上次获取时间在10秒内，则不重复请求\r\n      const now = Date.now();\r\n      if (now - state.lastFetchTime < 10000) {\r\n        return { code: 0, message: 'use cache', data: { unreadCount: state.unreadCount } };\r\n      }\r\n      \r\n      const res = await getUnreadCount();\r\n      if (res.code === 0) {\r\n        commit('SET_UNREAD_COUNT', res.data.unreadCount);\r\n        commit('UPDATE_FETCH_TIME');\r\n      } else {\r\n        console.error('获取未读消息数量失败', res.message);\r\n      }\r\n      return res;\r\n    } catch (error) {\r\n      console.error('获取未读消息数量接口异常', error);\r\n      return {\r\n        code: -1,\r\n        message: '网络异常',\r\n        data: null\r\n      };\r\n    }\r\n  },\r\n  \r\n  // 更新消息数量（无需请求API，直接更新本地状态）\r\n  updateUnreadCount({ commit }, count) {\r\n    commit('SET_UNREAD_COUNT', count);\r\n    commit('UPDATE_FETCH_TIME');\r\n  },\r\n  \r\n  // 增加未读消息数量（用于收到新消息推送时）\r\n  increaseUnreadCount({ commit, state }, count = 1) {\r\n    const newCount = state.unreadCount + count;\r\n    commit('SET_UNREAD_COUNT', newCount);\r\n    commit('UPDATE_FETCH_TIME');\r\n  },\r\n  \r\n  // 清空未读消息数量\r\n  clearUnreadCount({ commit }) {\r\n    commit('SET_UNREAD_COUNT', 0);\r\n    commit('UPDATE_FETCH_TIME');\r\n  }\r\n};\r\n\r\nconst getters = {\r\n  // 获取未读消息数量\r\n  unreadCount: (state) => state.unreadCount,\r\n};\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions,\r\n  getters,\r\n}; "],"names":["state","getUnreadCount","uni"],"mappings":";;;AAGA,MAAM,QAAQ;AAAA,EACZ,aAAa;AAAA;AAAA,EACb,eAAe;AAAA;AACjB;AAEA,MAAM,YAAY;AAAA;AAAA,EAEhB,iBAAiBA,QAAO,OAAO;AAC7B,IAAAA,OAAM,cAAc;AAAA,EACrB;AAAA;AAAA,EAED,kBAAkBA,QAAO;AACvB,IAAAA,OAAM,gBAAgB,KAAK;EAC5B;AACH;AAEA,MAAM,UAAU;AAAA;AAAA,EAEd,MAAM,eAAe,EAAE,QAAQ,OAAAA,UAAS;AACtC,QAAI;AAEF,YAAM,MAAM,KAAK;AACjB,UAAI,MAAMA,OAAM,gBAAgB,KAAO;AACrC,eAAO,EAAE,MAAM,GAAG,SAAS,aAAa,MAAM,EAAE,aAAaA,OAAM,YAAW;MAC/E;AAED,YAAM,MAAM,MAAMC,aAAAA;AAClB,UAAI,IAAI,SAAS,GAAG;AAClB,eAAO,oBAAoB,IAAI,KAAK,WAAW;AAC/C,eAAO,mBAAmB;AAAA,MAClC,OAAa;AACLC,sBAAc,MAAA,MAAA,SAAA,kCAAA,cAAc,IAAI,OAAO;AAAA,MACxC;AACD,aAAO;AAAA,IACR,SAAQ,OAAO;AACdA,oBAAA,MAAA,MAAA,SAAA,kCAAc,gBAAgB,KAAK;AACnC,aAAO;AAAA,QACL,MAAM;AAAA,QACN,SAAS;AAAA,QACT,MAAM;AAAA,MACd;AAAA,IACK;AAAA,EACF;AAAA;AAAA,EAGD,kBAAkB,EAAE,OAAQ,GAAE,OAAO;AACnC,WAAO,oBAAoB,KAAK;AAChC,WAAO,mBAAmB;AAAA,EAC3B;AAAA;AAAA,EAGD,oBAAoB,EAAE,QAAQ,OAAAF,OAAK,GAAI,QAAQ,GAAG;AAChD,UAAM,WAAWA,OAAM,cAAc;AACrC,WAAO,oBAAoB,QAAQ;AACnC,WAAO,mBAAmB;AAAA,EAC3B;AAAA;AAAA,EAGD,iBAAiB,EAAE,UAAU;AAC3B,WAAO,oBAAoB,CAAC;AAC5B,WAAO,mBAAmB;AAAA,EAC3B;AACH;AAEA,MAAM,UAAU;AAAA;AAAA,EAEd,aAAa,CAACA,WAAUA,OAAM;AAChC;AAEA,MAAe,UAAA;AAAA,EACb,YAAY;AAAA,EACZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;;"}