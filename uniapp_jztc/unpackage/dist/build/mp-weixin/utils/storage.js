"use strict";const t=require("../common/vendor.js"),e=require("./constants.js");function r(e,r){try{t.index.setStorageSync(e,r)}catch(n){console.error(`数据存储失败 [${e}]`)}}function n(e){try{return t.index.getStorageSync(e)}catch(r){return console.error(`数据读取失败 [${e}]`),null}}function o(e){try{t.index.removeStorageSync(e)}catch(r){console.error(`数据删除失败 [${e}]`)}}function c(){return n(e.STORAGE_KEYS.IDLE_DRAFT)||[]}function i(){return n(e.STORAGE_KEYS.INFO_DRAFT)||[]}exports.clearUserLoginState=function(){o(e.STORAGE_KEYS.USER_INFO),o(e.STORAGE_KEYS.TOKEN)},exports.deleteIdleDraft=function(t){try{let n=c();return n=n.filter((e=>e.id!==t)),r(e.STORAGE_KEYS.IDLE_DRAFT,n),!0}catch(n){return console.error("删除闲置物品草稿失败",n),!1}},exports.deleteInfoDraft=function(t){try{let n=i();return n=n.filter((e=>e.id!==t)),r(e.STORAGE_KEYS.INFO_DRAFT,n),!0}catch(n){return console.error("删除信息发布草稿失败",n),!1}},exports.getAllDraftList=function(){return[...c(),...i()].sort(((t,e)=>new Date(e.updateTime)-new Date(t.updateTime)))},exports.getIdleDraft=function(t){return c().find((e=>e.id===t))||null},exports.getInfoDraft=function(t){return i().find((e=>e.id===t))||null},exports.getToken=function(){return n(e.STORAGE_KEYS.TOKEN)||""},exports.getUserInfo=function(){const t=n(e.STORAGE_KEYS.USER_INFO)||{};return t&&t.id&&!t.clientId&&(t.clientId=t.id),t},exports.saveIdleDraft=function(t){try{const n=c()||[],o=Date.now(),i={...t,id:o,updateTime:(new Date).toISOString(),type:"idle"};return n.unshift(i),r(e.STORAGE_KEYS.IDLE_DRAFT,n),o}catch(n){return console.error("保存闲置物品草稿失败",n),0}},exports.saveInfoDraft=function(t){try{const n=i()||[],o=Date.now(),c={...t,id:o,updateTime:(new Date).toISOString(),type:"info"};return n.unshift(c),r(e.STORAGE_KEYS.INFO_DRAFT,n),o}catch(n){return console.error("保存信息发布草稿失败",n),0}},exports.setToken=function(t){r(e.STORAGE_KEYS.TOKEN,t)},exports.setUserInfo=function(t){r(e.STORAGE_KEYS.USER_INFO,t)};
