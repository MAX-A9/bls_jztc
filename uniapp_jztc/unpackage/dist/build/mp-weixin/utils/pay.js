"use strict";const e=require("../common/vendor.js"),a=require("../apis/pay.js");exports.requestOrderPay=function(s){return new Promise((async(r,t)=>{try{const n=await a.orderPay(s);if(0!==n.code||!n.data)throw new Error(n.message||"支付下单失败");const c=n.data;e.index.requestPayment({provider:"wxpay",timeStamp:c.timeStamp,nonceStr:c.nonceStr,package:c.package,signType:c.signType,paySign:c.paySign,success:function(e){r({success:!0,message:"支付成功",data:e})},fail:function(e){"requestPayment:fail cancel"===e.errMsg?r({success:!1,message:"用户取消支付",data:e}):t(new Error(e.errMsg||"支付失败"))}})}catch(n){t(n)}}))},exports.requestWxPay=function(s){return new Promise((async(r,t)=>{try{const n=await a.unifiedOrder(s);if(0!==n.code||!n.data)throw new Error(n.message||"支付下单失败");const c=n.data;e.index.requestPayment({provider:"wxpay",timeStamp:c.timeStamp,nonceStr:c.nonceStr,package:c.package,signType:c.signType,paySign:c.paySign,success:function(e){r({success:!0,message:"支付成功",data:e})},fail:function(e){"requestPayment:fail cancel"===e.errMsg?r({success:!1,message:"用户取消支付",data:e}):t(new Error(e.errMsg||"支付失败"))}})}catch(n){t(n)}}))};
