"use strict";const e=require("../../../common/vendor.js"),t=require("../../../mixins/device.js"),s=require("../../../apis/index.js"),o=require("../../../common/assets.js"),i={components:{uniIcons:()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js",uniLoadMore:()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more.js"},mixins:[t.deviceMixin],data:()=>({recordList:[],page:1,size:10,totalPages:0,isLoading:!1,loadMoreStatus:"more"}),onLoad(){this.getExchangeRecords()},onPullDownRefresh(){this.page=1,this.recordList=[],this.getExchangeRecords().then((()=>{e.index.stopPullDownRefresh()}))},onReachBottom(){this.page<this.totalPages&&"loading"!==this.loadMoreStatus&&(this.page++,this.loadMoreStatus="loading",this.getExchangeRecords())},methods:{handleBack(){e.index.navigateBack()},formatStatus(e){if(!e)return"未知状态";const t="string"==typeof e?e.toLowerCase():e;return"processing"===t||"处理中"===t?"处理中":"completed"===t||"已完成"===t?"已完成":"failed"===t||"失败"===t?"失败":e},getStatusClass(e){const t="string"==typeof e?e.toLowerCase():e;return"processing"===t||"处理中"===t?"status-processing":"completed"===t||"已完成"===t?"status-success":"failed"===t||"失败"===t?"status-failed":"status-processing"},async getExchangeRecords(){if(!this.isLoading)try{this.isLoading=!0;const t={page:this.page,size:this.size},o=await s.vip.getExchangeRecords(t);0===o.code&&o.data?(1===this.page?this.recordList=o.data.list||[]:this.recordList=[...this.recordList,...o.data.list||[]],this.totalPages=o.data.pages||0,this.page>=this.totalPages?this.loadMoreStatus="noMore":this.loadMoreStatus="more"):e.index.showToast({title:o.message||"获取兑换记录失败",icon:"none"})}catch(t){console.error("获取兑换记录失败:",t),e.index.showToast({title:"获取记录失败，请重试",icon:"none"})}finally{this.isLoading=!1}}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-load-more/uni-load-more.js"))();const a=e._export_sfc(i,[["render",function(t,s,i,a,n,r){return e.e({a:t.statusBarHeight+"px",b:e.p({type:"left",size:"20",color:"#333333"}),c:e.o(((...e)=>r.handleBack&&r.handleBack(...e))),d:e.f(n.recordList,((t,s,o)=>e.e({a:e.t(t.exchangeTime),b:e.t(r.formatStatus(t.status)),c:e.n(r.getStatusClass(t.status)),d:e.t(t.productName),e:e.t(t.duration),f:e.t(t.rechargeAccount),g:t.remark},t.remark?{h:e.t(t.remark)}:{},{i:t.id}))),e:n.recordList.length>0},n.recordList.length>0?{f:e.p({status:n.loadMoreStatus})}:{},{g:0===n.recordList.length&&!n.isLoading},0!==n.recordList.length||n.isLoading?{}:{h:o._imports_0$3})}]]);wx.createPage(a);
