"use strict";const e=require("../../../common/vendor.js"),t=require("../../../mixins/device.js"),i=require("../../../utils/storage.js"),a=require("../../../utils/device-info.js"),r=require("../../../common/assets.js"),s={mixins:[t.deviceMixin],data:()=>({statusBarHeight:0,navBarHeight:44,draftList:[]}),onLoad(){this.statusBarHeight=a.deviceInfo.getStatusBarHeight(),this.loadDraftList()},methods:{handleBack(){e.index.navigateBack()},loadDraftList(){this.draftList=i.getAllDraftList()},formatTime(e){if(!e)return"未知时间";const t=new Date(e),i=new Date-t;if(i<36e5){const e=Math.floor(i/6e4);return""+(0===e?"刚刚":e+"分钟前")}if(i<864e5){return`${Math.floor(i/36e5)}小时前`}if(i<6048e5){return`${Math.floor(i/864e5)}天前`}return`${t.getMonth()+1}月${t.getDate()}日`},getTitlePreview(e){if(e.title&&e.title.trim())return e.title;if(e.description&&e.description.trim()){const t=e.description.slice(0,20);return t.length>=20?t+"...":t}return"idle"===e.type?"闲置物品草稿":"信息发布草稿"},handleDraftClick(t){"idle"===t.type?e.index.navigateTo({url:`/pages/publish/idle/index?draftId=${t.id}`}):e.index.navigateTo({url:`/pages/publish/info/index?draftId=${t.id}`})},handleDeleteDraft(t){e.index.showModal({title:"提示",content:"确定要删除该草稿吗？",success:a=>{if(a.confirm){let a=!1;a="idle"===t.type?i.deleteIdleDraft(t.id):i.deleteInfoDraft(t.id),a?(e.index.showToast({title:"删除成功",icon:"success"}),this.loadDraftList()):e.index.showToast({title:"删除失败",icon:"none"})}}})},handleClearAll(){e.index.showModal({title:"提示",content:"确定要清空所有草稿吗？",success:t=>{t.confirm&&(this.draftList.forEach((e=>{"idle"===e.type?i.deleteIdleDraft(e.id):i.deleteInfoDraft(e.id)})),this.draftList=[],e.index.showToast({title:"清空成功",icon:"success"}))}})}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const n=e._export_sfc(s,[["render",function(t,i,a,s,n,d){return e.e({a:e.p({type:"left",size:"20",color:"#333333"}),b:e.o(((...e)=>d.handleBack&&d.handleBack(...e))),c:n.draftList.length>0},n.draftList.length>0?{d:e.o(((...e)=>d.handleClearAll&&d.handleClearAll(...e)))}:{},{e:n.navBarHeight+"px",f:n.statusBarHeight+"px",g:`calc(${n.statusBarHeight}px + ${n.navBarHeight}px)`,h:n.draftList.length>0},n.draftList.length>0?{i:e.f(n.draftList,((t,i,a)=>({a:e.t(d.getTitlePreview(t)),b:e.t("idle"===t.type?"闲置":"信息"),c:e.t(d.formatTime(t.updateTime)),d:"481b4036-1-"+a,e:e.o((e=>d.handleDeleteDraft(t)),t.id),f:t.id,g:e.o((e=>d.handleDraftClick(t)),t.id)}))),j:e.p({type:"trash",size:"18",color:"#ff4500"})}:{k:r._imports_0$1})}]]);wx.createPage(n);
