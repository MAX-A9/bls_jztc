"use strict";const e=require("../../../common/vendor.js"),r=require("../../../mixins/device.js"),t=require("../../../apis/index.js"),a=require("../../../utils/pay.js"),o=require("../../../common/assets.js"),i={mixins:[r.deviceMixin],data:()=>({orderId:null,orderNo:null,loading:!0,orderDetail:null}),onLoad(r){r.id?(this.orderId=r.id,this.loadOrderDetail()):r.orderNo?(this.orderNo=r.orderNo,this.loadOrderDetail()):(this.loading=!1,e.index.showToast({title:"订单参数不存在",icon:"none"}))},methods:{handleBack(){getCurrentPages().length>1?e.index.navigateBack():e.index.redirectTo({url:"/pages/my/orders/index"})},async loadOrderDetail(){let r=!1;try{this.loading=!0,e.index.showLoading({title:"加载中...",mask:!0}),r=!0;const a=this.orderNo?{orderNo:this.orderNo}:{id:this.orderId},o=await t.user.getOrderDetail(a);if(r&&(e.index.hideLoading(),r=!1),0!==o.code||!o.data)throw new Error(o.message||"获取订单详情失败");this.orderDetail=o.data,this.loading=!1}catch(a){r&&(e.index.hideLoading(),r=!1),console.error("获取订单详情失败:",a),e.index.showToast({title:"获取订单失败",icon:"none"}),this.loading=!1}finally{r&&e.index.hideLoading()}},getStatusClass(e){switch(e){case 0:return"unpaid";case 1:return"paid";case 2:return"cancelled";case 3:return"refunded";case 4:return"processing";case 5:return"completed";default:return""}},getStatusDesc(e){switch(e){case 0:return"请及时完成支付";case 1:return"您的订单已支付";case 2:return"您的订单已取消";case 3:return"您的订单已退款";case 4:return"您的订单正在进行中";case 5:return"您的订单已完成";default:return""}},getPaymentMethodText(e){switch(e){case"wechat":return"微信支付";case"alipay":return"支付宝";default:return"未知"}},copyOrderNo(){this.orderDetail&&this.orderDetail.orderNo&&e.index.setClipboardData({data:this.orderDetail.orderNo,success:()=>{e.index.showToast({title:"复制成功",icon:"success"})}})},handleCancelOrder(){e.index.showModal({title:"提示",content:"确定要取消该订单吗？",success:async r=>{if(r.confirm){let r=!1;try{e.index.showLoading({title:"处理中...",mask:!0}),r=!0,await t.user.cancelOrder({orderNo:this.orderDetail.orderNo,reason:"用户主动取消"}),r&&(e.index.hideLoading(),r=!1),e.index.showToast({title:"已取消订单",icon:"success"}),this.loadOrderDetail()}catch(a){r&&(e.index.hideLoading(),r=!1),console.error("取消订单失败:",a),e.index.showToast({title:a.message||"取消失败",icon:"none"})}finally{r&&e.index.hideLoading()}}}})},async handlePayOrder(){let r=!1;try{e.index.showLoading({title:"正在支付...",mask:!0}),r=!0;const t=await a.requestOrderPay({orderNo:this.orderDetail.orderNo});r&&(e.index.hideLoading(),r=!1),t.success?(e.index.showToast({title:"支付成功",icon:"success"}),this.loadOrderDetail()):e.index.showToast({title:t.message||"支付已取消",icon:"none"})}catch(t){r&&(e.index.hideLoading(),r=!1),console.error("支付过程出错:",t),e.index.showToast({title:t.message||"支付失败",icon:"none"})}finally{r&&e.index.hideLoading()}},handleContactService(){console.log("联系客服")},handleRebuyOrder(){console.log("再次购买")}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const d=e._export_sfc(i,[["render",function(r,t,a,i,d,s){return e.e({a:e.p({type:"left",size:"20",color:"#333333"}),b:e.o(((...e)=>s.handleBack&&s.handleBack(...e))),c:r.navBarHeight+"px",d:r.statusBarHeight+"px",e:`calc(${r.statusBarHeight}px + ${r.navBarHeight}px)`,f:d.loading},d.loading?{g:e.p({type:"spinner-cycle",size:"30",color:"#999999"})}:d.orderDetail?e.e({i:e.t(d.orderDetail.statusText),j:e.n(s.getStatusClass(d.orderDetail.status)),k:e.t(s.getStatusDesc(d.orderDetail.status)),l:e.p({type:"shop",size:"30",color:"#fc3e2b"}),m:e.t(d.orderDetail.productName),n:e.t(d.orderDetail.amount.toFixed(2)),o:e.t(d.orderDetail.orderNo),p:e.o(((...e)=>s.copyOrderNo&&s.copyOrderNo(...e))),q:e.t(d.orderDetail.createdAt),r:d.orderDetail.payTime},d.orderDetail.payTime?{s:e.t(d.orderDetail.payTime)}:{},{t:e.t(s.getPaymentMethodText(d.orderDetail.paymentMethod)),v:d.orderDetail.remark},d.orderDetail.remark?{w:e.t(d.orderDetail.remark)}:{},{x:e.t(d.orderDetail.amount.toFixed(2)),y:0===d.orderDetail.status},0===d.orderDetail.status?{z:e.o(((...e)=>s.handleCancelOrder&&s.handleCancelOrder(...e))),A:e.o(((...e)=>s.handlePayOrder&&s.handlePayOrder(...e)))}:1===d.orderDetail.status||4===d.orderDetail.status?{C:e.o(((...e)=>s.handleContactService&&s.handleContactService(...e)))}:2===d.orderDetail.status||3===d.orderDetail.status||5===d.orderDetail.status?{E:e.o(((...e)=>s.handleRebuyOrder&&s.handleRebuyOrder(...e)))}:{},{B:1===d.orderDetail.status||4===d.orderDetail.status,D:2===d.orderDetail.status||3===d.orderDetail.status||5===d.orderDetail.status}):{F:o._imports_0,G:e.o(((...e)=>s.handleBack&&s.handleBack(...e)))},{h:d.orderDetail})}]]);wx.createPage(d);
