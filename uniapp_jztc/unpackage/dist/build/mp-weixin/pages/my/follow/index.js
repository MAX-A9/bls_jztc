"use strict";const e=require("../../../common/vendor.js"),i=require("../../../apis/content.js"),s=require("../../../common/assets.js"),t={data:()=>({isRefreshing:!1,loading:!1,userList:[],currentPage:1,pageSize:10,hasMore:!0,total:0}),onLoad(){this.loadFollowingList()},methods:{async loadFollowingList(){if(!this.loading){this.loading=!0;try{const s=await i.getFollowingList({page:this.currentPage,size:this.pageSize});0===s.code&&s.data?(1===this.currentPage?this.userList=s.data.list||[]:this.userList=[...this.userList,...s.data.list||[]],this.total=s.data.total||0,this.hasMore=this.userList.length<this.total):e.index.showToast({title:s.message||"加载失败",icon:"none"})}catch(s){console.error("加载关注列表失败:",s),e.index.showToast({title:"网络异常，请稍后重试",icon:"none"})}finally{this.loading=!1,this.isRefreshing&&(this.isRefreshing=!1)}}},async onRefresh(){this.isRefreshing=!0,this.currentPage=1,await this.loadFollowingList(),this.isRefreshing&&(this.isRefreshing=!1)},loadMore(){!this.loading&&this.hasMore&&(this.currentPage++,this.loadFollowingList())},handleUserClick(i){i&&i.client_id&&e.index.navigateTo({url:`/pages/user/detail?id=${i.client_id}`})},async toggleFollow(s,t){s&&s.client_id&&e.index.showModal({title:"提示",content:"确定要取消关注吗？",success:async o=>{if(o.confirm)try{e.index.showLoading({title:"处理中...",mask:!0});const o=await i.unfollowUser({publisher_id:s.client_id});if(e.index.hideLoading(),!o||0!==o.code)throw new Error((null==o?void 0:o.message)||"操作失败");this.userList.splice(t,1),this.total--,e.index.showToast({title:"已取消关注",icon:"success"})}catch(n){e.index.hideLoading(),console.error("取消关注失败:",n),e.index.showToast({title:n.message||"操作失败，请重试",icon:"none"})}}})},handleExplore(){e.index.switchTab({url:"/pages/index/index"})}}};const o=e._export_sfc(t,[["render",function(i,t,o,n,a,l){return e.e({a:a.loading&&0===a.userList.length},(a.loading&&a.userList.length,{}),{b:a.userList.length>0},a.userList.length>0?e.e({c:e.f(a.userList,((i,s,t)=>({a:i.avatar_url||"/static/avatar/default.png",b:e.t(i.real_name),c:e.t(i.publish_count||0),d:e.o((e=>l.toggleFollow(i,s)),i.client_id),e:i.client_id,f:e.o((e=>l.handleUserClick(i)),i.client_id)}))),d:a.hasMore&&!a.loading},(a.hasMore&&a.loading,{}),{e:a.loading&&a.userList.length>0},(a.loading&&a.userList.length,{}),{f:!a.hasMore&&a.userList.length>0},(!a.hasMore&&a.userList.length,{})):{},{g:!a.loading&&0===a.userList.length},a.loading||0!==a.userList.length?{}:{h:s._imports_0,i:e.o(((...e)=>l.handleExplore&&l.handleExplore(...e)))},{j:a.isRefreshing,k:e.o(((...e)=>l.onRefresh&&l.onRefresh(...e))),l:e.o(((...e)=>l.loadMore&&l.loadMore(...e)))})}]]);wx.createPage(o);
