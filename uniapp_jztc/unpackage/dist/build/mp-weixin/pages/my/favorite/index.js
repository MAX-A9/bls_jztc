"use strict";const t=require("../../../common/vendor.js"),i=require("../../../apis/content.js"),a=require("../../../common/assets.js"),e={data:()=>({currentTab:0,tabList:["闲置","帖子"],isRefreshing:!1,loading:!1,favoriteList:[],postList:[],favoriteParams:{page:1,pageSize:10,type:2},postParams:{page:1,pageSize:10,type:1},hasMore:!0,favoriteTotal:0,postTotal:0}),onLoad(){this.loadFavoriteData()},methods:{switchTab(t){this.currentTab!==t&&(this.currentTab=t,0===t&&0===this.favoriteList.length?this.loadFavoriteData():1===t&&0===this.postList.length&&this.loadPostData())},async loadFavoriteData(){if(!this.loading){this.loading=!0;try{const a=await i.getFavoriteList({page:this.favoriteParams.page,pageSize:this.favoriteParams.pageSize,type:this.favoriteParams.type});0===a.code&&a.data?(1===this.favoriteParams.page?this.favoriteList=a.data.list||[]:this.favoriteList=[...this.favoriteList,...a.data.list||[]],this.favoriteTotal=a.data.total||0,this.hasMore=this.favoriteList.length<this.favoriteTotal):t.index.showToast({title:a.message||"加载失败",icon:"none"})}catch(a){t.index.showToast({title:"网络异常，请稍后重试",icon:"none"})}finally{this.loading=!1,this.isRefreshing&&(this.isRefreshing=!1)}}},async loadPostData(){if(!this.loading){this.loading=!0;try{const a=await i.getFavoriteList({page:this.postParams.page,pageSize:this.postParams.pageSize,type:this.postParams.type});0===a.code&&a.data?(1===this.postParams.page?this.postList=a.data.list||[]:this.postList=[...this.postList,...a.data.list||[]],this.postTotal=a.data.total||0,this.hasMore=this.postList.length<this.postTotal):t.index.showToast({title:a.message||"加载失败",icon:"none"})}catch(a){t.index.showToast({title:"网络异常，请稍后重试",icon:"none"})}finally{this.loading=!1,this.isRefreshing&&(this.isRefreshing=!1)}}},async onRefresh(){this.isRefreshing=!0,0===this.currentTab?(this.favoriteParams.page=1,await this.loadFavoriteData()):(this.postParams.page=1,await this.loadPostData())},loadMore(){!this.loading&&this.hasMore&&(0===this.currentTab?(this.favoriteParams.page++,this.loadFavoriteData()):(this.postParams.page++,this.loadPostData()))},handleItemClick(i){0===this.currentTab||2===i.type?t.index.navigateTo({url:`/pages/community/detail?id=${i.id}`}):t.index.navigateTo({url:`/pages/content/detail?id=${i.id}`})},async toggleFavorite(a,e,s){t.index.showModal({title:"提示",content:"确定要取消收藏吗？",success:async o=>{if(o.confirm)try{const o=await i.cancelFavorite(a);0===o.code?(1===e?this.postList.splice(s,1):this.favoriteList.splice(s,1),t.index.showToast({title:"已取消收藏",icon:"success"})):t.index.showToast({title:o.message||"操作失败",icon:"none"})}catch(r){t.index.showToast({title:"网络异常，请稍后重试",icon:"none"})}}})},handleExplore(){t.index.switchTab({url:"/pages/index/index"})}}};if(!Array){t.resolveComponent("uni-icons")()}Math;const s=t._export_sfc(e,[["render",function(i,e,s,o,r,n){return t.e({a:t.f(r.tabList,((i,a,e)=>({a:t.t(i),b:a,c:r.currentTab===a?1:"",d:t.o((t=>n.switchTab(a)),a)}))),b:0===r.currentTab&&r.favoriteList.length>0},0===r.currentTab&&r.favoriteList.length>0?t.e({c:t.f(r.favoriteList,((i,a,e)=>t.e({a:i.image,b:t.t(i.title),c:i.price>0},i.price>0?{d:t.t(i.price)}:{},{e:t.t(i.publisher),f:"0496ab34-0-"+e,g:t.o((t=>n.toggleFavorite(i.id,2,a)),i.id),h:i.id,i:t.o((t=>n.handleItemClick(i)),i.id)}))),d:t.p({type:"star-filled",size:"20",color:"#fc3e2b"}),e:r.hasMore&&!r.loading},(r.hasMore&&r.loading,{}),{f:r.loading},(r.loading,{}),{g:!r.hasMore&&r.favoriteList.length>0},(!r.hasMore&&r.favoriteList.length,{})):{},{h:1===r.currentTab&&r.postList.length>0},1===r.currentTab&&r.postList.length>0?t.e({i:t.f(r.postList,((i,a,e)=>t.e({a:i.image},i.image?{b:i.image}:{},{c:t.t(i.title),d:t.t(i.publisher),e:"0496ab34-1-"+e,f:t.o((t=>n.toggleFavorite(i.id,1,a)),i.id),g:i.image?"":1,h:i.id,i:t.o((t=>n.handleItemClick(i)),i.id)}))),j:t.p({type:"star-filled",size:"20",color:"#fc3e2b"}),k:r.hasMore&&!r.loading},(r.hasMore&&r.loading,{}),{l:r.loading},(r.loading,{}),{m:!r.hasMore&&r.postList.length>0},(!r.hasMore&&r.postList.length,{})):{},{n:0===r.currentTab&&0===r.favoriteList.length&&!r.loading||1===r.currentTab&&0===r.postList.length&&!r.loading},0===r.currentTab&&0===r.favoriteList.length&&!r.loading||1===r.currentTab&&0===r.postList.length&&!r.loading?{o:a._imports_0,p:t.o(((...t)=>n.handleExplore&&n.handleExplore(...t)))}:{},{q:r.isRefreshing,r:t.o(((...t)=>n.onRefresh&&n.onRefresh(...t))),s:t.o(((...t)=>n.loadMore&&n.loadMore(...t)))})}]]);wx.createPage(s);
