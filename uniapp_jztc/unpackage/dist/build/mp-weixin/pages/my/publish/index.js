"use strict";const e=require("../../../common/vendor.js"),s=require("../../../apis/index.js"),i=require("../../../common/assets.js"),t={data:()=>({activeType:0,isRefreshing:!1,loading:!1,publishList:[],page:1,pageSize:10,total:0,hasMore:!0}),onLoad(){this.loadPublishList()},methods:{switchTab(e){this.activeType!==e&&(this.activeType=e,this.resetAndLoadList())},resetAndLoadList(){this.publishList=[],this.page=1,this.hasMore=!0,this.loadPublishList()},async loadPublishList(){if(this.hasMore&&!this.loading){this.loading=!0;try{const i={page:this.page,pageSize:this.pageSize,type:this.activeType},t=await s.publish.getMyPublishList(i);if(0===t.code&&t.data){const{list:e,total:s,page:i,pages:a}=t.data;this.publishList=1===this.page?e:[...this.publishList,...e],this.total=s,this.hasMore=i<a,this.hasMore&&this.page++}else e.index.showToast({title:t.message||"加载失败",icon:"none"})}catch(i){console.error("加载发布列表失败",i),e.index.showToast({title:"加载失败",icon:"none"})}finally{this.loading=!1}}},async onRefresh(){this.isRefreshing=!0,this.resetAndLoadList(),setTimeout((()=>{this.isRefreshing=!1}),1e3)},loadMore(){this.loadPublishList()},getStatusClass(e){switch(e){case"已发布":return"published";case"已下架":return"offline";case"已售出":return"sold";case"审核中":return"pending";default:return"default"}},handleItemClick(s){e.index.navigateTo({url:`/pages/content/detail?id=${s.id}`})},handleEdit(s){e.index.navigateTo({url:`/pages/publish/edit?id=${s.id}`})},handleDelete(i,t){e.index.showModal({title:"提示",content:"确定要删除该发布吗？",success:async a=>{if(a.confirm)try{const a=await s.publish.deleteContent(i.id);0===a.code?(this.publishList.splice(t,1),e.index.showToast({title:"删除成功",icon:"success"})):e.index.showToast({title:a.message||"删除失败",icon:"none"})}catch(h){console.error("删除失败",h),e.index.showToast({title:"删除失败",icon:"none"})}}})},handlePublish(){e.index.switchTab({url:"/pages/publish/index"})}}};const a=e._export_sfc(t,[["render",function(s,t,a,h,o,n){return e.e({a:0===o.activeType?1:"",b:e.o((e=>n.switchTab(0))),c:1===o.activeType?1:"",d:e.o((e=>n.switchTab(1))),e:2===o.activeType?1:"",f:e.o((e=>n.switchTab(2))),g:o.publishList.length>0},o.publishList.length>0?{h:e.f(o.publishList,((s,i,t)=>({a:e.t(s.status),b:e.n(n.getStatusClass(s.status)),c:e.t(s.category),d:e.t(s.title),e:e.t(s.publishedAt),f:e.o((e=>n.handleEdit(s)),s.id),g:e.o((e=>n.handleDelete(s,i)),s.id),h:s.id,i:e.o((e=>n.handleItemClick(s)),s.id)})))}:{},{i:o.publishList.length>0&&o.hasMore},(o.publishList.length>0&&o.hasMore,{}),{j:o.publishList.length>0&&!o.hasMore},(o.publishList.length>0&&o.hasMore,{}),{k:0===o.publishList.length&&!o.loading},0!==o.publishList.length||o.loading?{}:{l:i._imports_0,m:e.o(((...e)=>n.handlePublish&&n.handlePublish(...e)))},{n:o.isRefreshing,o:e.o(((...e)=>n.onRefresh&&n.onRefresh(...e))),p:e.o(((...e)=>n.loadMore&&n.loadMore(...e)))})}]]);wx.createPage(a);
